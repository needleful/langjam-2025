<!DOCTYPE html>
<html>
	<head>
		<title>Duet</title>
		<style>
			#editor-container {
				display:flex;
			}
			#editor {
				flex:1.6;
			}
			#file-panel {
				flex:0.5;
			}
			#editor-root {
				position:relative;
				height: 400pt;
			}
			.code-container {
				margin: 10px;
				padding: 10px;
				border: 0;
				width: calc(100% - 32px);
				height: 400pt;
				position: absolute;
				top: 0;
				left: 0;
				overflow: scroll;
				white-space: pre;
			}
			#editor-text {
				z-index: 1;
				color: transparent;
				background: transparent;
				caret-color: black;
				resize: none;
			}

			.code-fonts {
				color: #333;
			}

			.code-operator, .code-digits, .code-period, .code-escapedStringText {
				font-weight:bold;
			}
			.code-comment {
				font-style: italic;
				color: black;
			}
			.code-quote, .code-stringText {
				font-style: italic;
			}
			.code-header {
				font-weight:bold;
				text-decoration: underline;
			}
			.code-condition {
				color: blue;
			}
			.code-declaration {
				color: green;
			}
			.code-invalid {
				text-decoration: wavy underline;
				color: red;
			}
			.code-error {
				text-decoration: underline;
				color: red;
			}
			.code-undefined {
				font-style: italic;
				text-decoration: wavy underline;
				color: #AA10DD;
			}
			.game-canvas {
				max-width: 99%;
			}
		</style>
		<script type='text/javascript' src='/duet.js'></script>
		<script type='text/javascript'>
			Duet.loadObject('/duet/game.duet').then(() => {
				Duet.switchTo('/duet/game.duet');
				Duet.loadObject('/duet/player.duet');
			});
		</script>
	</head>
	<body>
		<h1>Langjam Gamejam entry: Duet</h1>
		<canvas id='game-canvas' width='800' height='600' tabindex='1'>
		</canvas>
		<br/>
		<button id='button-pause' onclick='togglePause()'>Pause</button>
		<h2>Editor</h2>
		<h4 id='current-file'>Editing a new file</h4>
		<div id='editor-container'>
			<div id='editor'>
				<div id='editor-root'>
					<textarea id='editor-text' class='code-container' rows='20' 
						aria-hint='The keyboard can be captured by the text editor. Press escape to toggle this behavior.' spellcheck='false'
						oninput='Duet.lex(false)' onscroll='sync_scroll()'>#Type code here</textarea>
					<pre id='highlighting' class='code-container' aria-hidden='true' tabindex='-1'><code id='highlighting-content' class='code-fonts'></code></pre>
				</div>
				<br/>
				<p id='editor-status'>Tab Captured. Press Escape to Toggle</p>
				<button onclick="Duet.compileAndRun()">Compile and Run</button>
			</div>
			<div id='file-panel'>
				<h3>Files</h3>
				<input id='new-file-name' type='text' value='newFile.duet'/>
				<ul id='files-list'>
				</ul>
				<button onclick='Duet.createFile()'>Create File</button>
				<div id='loaded-images'>
				</div>
			</div>
		</div>
		<script type='text/javascript' src='/editor.js'></script>
		<script>
			let editor = new Editor(document.getElementById('editor-text'));
			editor.status = document.getElementById('editor-status');
			editor.run = Duet.compileAndRun;
			Duet.canvas = document.getElementById('game-canvas');
			window.addEventListener('keydown', (e) => {
				if(e.key != 'Tab' && document.activeElement == Duet.canvas) {
					e.preventDefault();
				}
			});

			function sync_scroll() {
				/* Scroll result to scroll coords of event - sync with textarea */
				let highlight = document.getElementById("highlighting");
				// Get and set x and y
				highlight.scrollTop = editor.text.scrollTop;
				highlight.scrollLeft = editor.text.scrollLeft;
			}
			function togglePause() {
				Duet.setPaused(!Duet.getPaused());
				let b = document.getElementById('button-pause');
				b.innerText = Duet.getPaused() ? 'Resume' : 'Pause';
			}
		</script>
	</body>
</html>