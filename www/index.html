<!DOCTYPE html>
<html>
	<meta charset='utf-8'/>
	<head>
		<title>Duet</title>
		<style>
			body {
				background-color: #DDD;
				color: #333;
			}
			#main-content {
				display:flex;
				flex-wrap: wrap;
			}
			#editor-status {
				padding-left: 2em;
				font-size: 0.8em;
				font-style: italic;
			}
			#files-list {
				margin: 0;
				padding: 0;
				display: inline-block;
			}
			#files-list li {
				display: inline-block;
			}
			#current-file {
				margin: 5pt;
			}
			#editor-root {
				position:relative;
				height: 55vh;
				min-height: 200pt;
			}
			#errors-list li {
				display: block;
				color: red;
			}
			.code-container {
				position: absolute;
				height: 55vh;
				min-height: 200pt;
				tab-size: 4;
				padding: 10pt;
				border: 0;
				width: calc(100% - 32px);
				top: 0;
				left: 0;
				overflow: scroll;
				white-space: pre;
				font-family: monospace;
				font-style: none;
				text-decoration: none;
			}
			#editor-text {
				z-index: 1;
				color: transparent;
				background: transparent;
				caret-color: black;
				resize: none;
				margin: 0;
			}
			#highlighting {
				margin: 0;
				background-color:#CCC;
			}

			.code-operator, .code-digits, .code-period, .code-escapedStringText {
				font-weight:bold;
			}
			.code-comment {
				font-style: italic;
				color: black;
			}
			.code-quote, .code-stringText {
				font-style: italic;
			}
			.code-header {
				font-weight:bold;
				text-decoration: underline;
			}
			.code-condition {
				color: blue;
			}
			.code-declaration {
				color: green;
			}
			.code-invalid {
				text-decoration: wavy underline;
				color: red;
			}
			.code-error {
				text-decoration: underline;
				color: red;
			}
			.code-undefined {
				font-style: italic;
				text-decoration: wavy underline;
				color: #AA10DD;
			}
			#game-container {
				flex:1.2;
				max-width: 99%;
			}
			#editor-container {
				flex: 1 1;
				max-width: 99%;
				min-width: 300pt;
				padding-left: 5pt;
			}
			#game-canvas {
				background-color: #333;
				margin: auto;
				display: block;
			}
		</style>
		<script type='text/javascript' src='duet.js'></script>
		<script type='text/javascript'>
			let newFiles = [
				'duet/game.duet',
				'duet/player.duet',
				'duet/enemy.duet'
			]
			async function loadSampleProject() {
				await Duet.loadObject('duet/game.duet');
				Duet.switchTo('duet/game.duet');
				for(let i = 1; i < newFiles.length; i++) {
					await Duet.loadObject(newFiles[i]);
				}
			}
			loadSampleProject();
		</script>
	</head>
	<body>
		<div id='main-content'>
			<div id='game-container'>
				<h1>Langjam Gamejam entry: Duet</h1>
				<canvas id='game-canvas' width='800' height='600' tabindex='1'>
				</canvas>
				<br/>
				<button id='button-pause' onclick='togglePause()'>Pause</button>
				<ul id='errors-list'>
				</ul>
			</div>
			<div id='editor-container'>
				<h2>Editor</h2>
				<h4 id='current-file'>Editing a new file</h4>
				<ul id='files-list'>
				</ul>
				<input id='new-file-name' type='text' value='newFile.duet'/>
				<button onclick='Duet.createFile()'>New Script</button>
				<div id='editor'>
					<div id='editor-root'>
						<textarea id='editor-text' class='code-container' rows='20' 
							aria-hint='This text editor can capture tab navigation. Press escape to toggle this behavior.' spellcheck='false'
							oninput='Duet.lex(false)' onscroll='sync_scroll()'>#Type code here</textarea>
						<pre id='highlighting' class='code-container' aria-hidden='true' tabindex='-1'><code id='highlighting-content' class='code-fonts'></code></pre>
					</div>
					<br/>
					<p id='editor-status'>Tab Captured. Press Escape to Toggle</p>
					<button onclick="Duet.compileAndRun()">Compile and Run</button>
					<p>You can also press Control+Enter to compile.</p>
					<div id='file-panel'>
						<h3>Loaded images</h3>
						<div id='loaded-images'>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<script type='text/javascript' src='editor.js'></script>
		<script>
			let editor = new Editor(document.getElementById('editor-text'));
			editor.status = document.getElementById('editor-status');
			editor.run = Duet.compileAndRun;
			Duet.canvas = document.getElementById('game-canvas');
			window.addEventListener('keydown', (e) => {
				if(e.key != 'Tab' && document.activeElement == Duet.canvas) {
					e.preventDefault();
				}
			});
			document.addEventListener('mousemove', Duet.mousemove);

			function sync_scroll() {
				/* Scroll result to scroll coords of event - sync with textarea */
				let highlight = document.getElementById("highlighting");
				// Get and set x and y
				highlight.scrollTop = editor.text.scrollTop;
				highlight.scrollLeft = editor.text.scrollLeft;
			}
			function togglePause() {
				Duet.setPaused(!Duet.getPaused());
			}
		</script>
	</body>
</html>